import { memo } from 'react';
import { PencilCursor } from './icons/pencil-cursor';
import { CommentCursor } from './icons/comment-cursor';
import { UserCursor } from './icons/user-cursor';
import { PointerCursor } from './icons/pointer-cursor';
import { GrabCursor } from './icons/grab-cursor';
import { GrabbingCursor } from './icons/grabbing-cursor';

export type CursorMode =
  | 'user'
  | 'pointer'
  | 'grab'
  | 'grabbing'
  | 'pencil'
  | 'eraser'
  | 'ascii'
  | 'comment';

interface CustomCursorProps {
  /** Viewport coordinates (clientX/clientY) */
  position: { x: number; y: number } | null;
  mode: CursorMode;
  /** Pencil stroke color — only used when mode is 'pencil' */
  strokeColor?: string;
}

// Hotspot offsets: translate so the functional point of the cursor aligns with the mouse position
const HOTSPOTS: Record<CursorMode, { x: number; y: number }> = {
  user: { x: -3, y: -3 },
  pointer: { x: -10, y: -2 },
  grab: { x: -11, y: -5 },
  grabbing: { x: -11, y: -10 },
  pencil: { x: -3, y: -3 },
  eraser: { x: -3, y: -3 },
  ascii: { x: -8, y: -8 },
  comment: { x: -3, y: -21 },
};

export const CustomCursor = memo(function CustomCursor({
  position,
  mode,
  strokeColor = '#000',
}: CustomCursorProps) {
  if (!position) return null;

  const hotspot = HOTSPOTS[mode];

  return (
    <div
      className="draw-cursor"
      style={{
        position: 'fixed',
        left: position.x,
        top: position.y,
        filter: 'drop-shadow(0px 0.5px 2px rgba(0, 0, 0, 0.25))',
      }}
    >
      <div style={{ transform: `translate(${hotspot.x}px, ${hotspot.y}px)` }}>
        {mode === 'user' && <UserCursor />}
        {mode === 'pointer' && <PointerCursor />}
        {mode === 'grab' && <GrabCursor />}
        {mode === 'grabbing' && <GrabbingCursor />}
        {mode === 'pencil' && <PencilCursor color={strokeColor} />}
        {mode === 'eraser' && (
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            {/* White fill — solid silhouette behind details */}
            <path fill="#fff" d="m21.093 16.463-3.882 3.88a2.25 2.25 0 0 1-3.182 0L2.905 9.22a2.25 2.25 0 0 1 0-3.182c.505-.504 1.49-1.461 2.208-2.155a3 3 0 0 1 2.043-.84l2.23-.028a3 3 0 0 1 1.968.702c.5.418 1.022.851.954.784-3.435-3.424 8.785 8.78 8.785 8.78a2.25 2.25 0 0 1 0 3.182"/>
            {/* Pink fill */}
            <path fill="#febed4" d="m21.093 16.463-3.882 3.88a2.25 2.25 0 0 1-3.182 0L2.905 9.22a2.25 2.25 0 0 1 0-3.182c.505-.504 1.49-1.461 2.208-2.155a3 3 0 0 1 2.043-.84l2.23-.028a3 3 0 0 1 1.968.702c.5.418 1.022.851.954.784-3.435-3.424 8.785 8.78 8.785 8.78a2.25 2.25 0 0 1 0 3.182"/>
            {/* White stroke outline — separate expanded path for consistent border */}
            <path stroke="white" strokeWidth="1.5" d="M15.62 21.503c.73 0 1.429-.29 1.944-.806l3.882-3.88a2.75 2.75 0 0 0 0-3.89l-.353.354.352-.354-.002-.002-.006-.007-.026-.026-.483-.483-1.338-1.336-3.824-3.82-3.069-3.066-.005-.008c-.013-.016-.026-.028-.03-.033l-.469-.467-.109-.108-.027-.027-.01-.01-.004-.003-.01-.01a1 1 0 0 0-.244-.093l-.114-.096a3.5 3.5 0 0 0-2.296-.818l-2.23.028a3.5 3.5 0 0 0-2.383.98c-.717.693-1.706 1.654-2.214 2.162a2.75 2.75 0 0 0 0 3.889l11.124 11.124a2.75 2.75 0 0 0 1.944.806Z"/>
            {/* Black details on top */}
            <path fill="#000" d="m21.093 16.463-3.882 3.88a2.25 2.25 0 0 1-3.182 0L2.905 9.22a2.25 2.25 0 0 1 0-3.182c.505-.504 1.49-1.461 2.208-2.155a3 3 0 0 1 2.043-.84l2.23-.028a3 3 0 0 1 1.968.702c.5.418 1.022.851.954.784-3.435-3.424 8.785 8.78 8.785 8.78a2.25 2.25 0 0 1 0 3.182M10.773 5.084A2 2 0 0 0 9.36 4.5H7.394a2 2 0 0 0-1.414.586L3.967 7.099a.75.75 0 0 0 0 1.06l2.91 2.91 4.94-4.94zm9.258 9.259-7.153-7.155-4.94 4.94 7.155 7.152a.75.75 0 0 0 1.06 0l3.88-3.88a.75.75 0 0 0 0-1.06z"/>
          </svg>
        )}
        {mode === 'ascii' && (
          <svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M25.9873 18.5616C26.128 18.7022 26.207 18.893 26.207 19.0919C26.207 19.2908 26.128 19.4816 25.9873 19.6222L24.9267 20.6829C24.515 21.0945 24.0132 21.4047 23.4609 21.5888C22.9086 21.7729 22.321 21.8259 21.7447 21.7435C21.827 22.3199 21.774 22.9074 21.5899 23.4597C21.4058 24.012 21.0957 24.5139 20.684 24.9255L19.6234 25.9862C19.4827 26.1268 19.292 26.2058 19.093 26.2058C18.8941 26.2058 18.7034 26.1268 18.5627 25.9862C18.4221 25.8455 18.343 25.6548 18.343 25.4558C18.343 25.2569 18.4221 25.0662 18.5627 24.9255L19.6234 23.8649C20.0453 23.4429 20.2824 22.8706 20.2824 22.2739C20.2824 21.6771 20.0453 21.1048 19.6234 20.6829L16.9717 18.0312L15.9111 19.0919C15.7704 19.2325 15.5796 19.3116 15.3807 19.3116C15.1818 19.3116 14.9911 19.2325 14.8504 19.0919C14.7098 18.9512 14.6307 18.7605 14.6307 18.5616C14.6307 18.3626 14.7098 18.1719 14.8504 18.0312L15.9111 16.9706L13.2594 14.3189C12.8375 13.897 12.2652 13.6599 11.6684 13.6599C11.0717 13.6599 10.4994 13.897 10.0774 14.3189L9.01677 15.3796C8.87612 15.5202 8.68535 15.5992 8.48644 15.5992C8.28753 15.5992 8.09676 15.5202 7.95611 15.3796C7.81546 15.2389 7.73644 15.0482 7.73644 14.8492C7.73644 14.6503 7.81546 14.4596 7.95611 14.3189L9.01677 13.2583C9.42843 12.8466 9.93027 12.5364 10.4826 12.3523C11.0349 12.1682 11.6224 12.1153 12.1988 12.1976C12.1164 11.6213 12.1694 11.0337 12.3535 10.4814C12.5376 9.92911 12.8478 9.42727 13.2594 9.01561L14.3201 7.95495C14.4607 7.8143 14.6515 7.73528 14.8504 7.73528C15.0493 7.73528 15.2401 7.8143 15.3807 7.95495C15.5214 8.0956 15.6004 8.28637 15.6004 8.48528C15.6004 8.68419 15.5214 8.87496 15.3807 9.01561L14.3201 10.0763C13.8981 10.4982 13.6611 11.0705 13.6611 11.6673C13.6611 12.264 13.8981 12.8363 14.3201 13.2583L16.9717 15.9099L18.0324 14.8492C18.173 14.7086 18.3638 14.6296 18.5627 14.6296C18.7616 14.6296 18.9524 14.7086 19.093 14.8492C19.2337 14.9899 19.3127 15.1807 19.3127 15.3796C19.3127 15.5785 19.2337 15.7693 19.093 15.9099L18.0324 16.9706L20.684 19.6222C21.106 20.0442 21.6783 20.2812 22.275 20.2812C22.8718 20.2812 23.4441 20.0442 23.866 19.6222L24.9267 18.5616C25.0673 18.4209 25.2581 18.3419 25.457 18.3419C25.6559 18.3419 25.8467 18.4209 25.9873 18.5616Z" fill="black"/>
            <path d="M8.66322 12.9047L8.84276 12.7348C9.27259 12.3523 9.77647 12.0604 10.324 11.8779C10.7566 11.7337 11.2088 11.6617 11.6622 11.661C11.6629 11.2076 11.7348 10.7554 11.879 10.3228C12.0877 9.69702 12.4394 9.1285 12.9059 8.66206L13.9665 7.6014C14.2009 7.36698 14.5189 7.23542 14.8504 7.23542C15.1819 7.23542 15.4999 7.36698 15.7343 7.6014C15.9687 7.83582 16.1003 8.15376 16.1003 8.48528C16.1003 8.8168 15.9687 9.13475 15.7343 9.36917L14.6736 10.4298C14.3454 10.758 14.1612 11.2031 14.1612 11.6673C14.1612 12.1314 14.3454 12.5765 14.6736 12.9047L16.9717 15.2028L17.6788 14.4957C17.9132 14.2613 18.2312 14.1297 18.5627 14.1297C18.8942 14.1297 19.2122 14.2613 19.4466 14.4957C19.681 14.7301 19.8126 15.0481 19.8126 15.3796C19.8126 15.7111 19.681 16.029 19.4466 16.2635L18.7395 16.9706L21.0376 19.2687L21.166 19.3847C21.4774 19.6399 21.8689 19.781 22.275 19.781C22.7392 19.781 23.1843 19.5968 23.5125 19.2687L24.5731 18.208C24.8075 17.9736 25.1255 17.842 25.457 17.842C25.7885 17.842 26.1065 17.9736 26.3409 18.208C26.5753 18.4424 26.7069 18.7604 26.7069 19.0919C26.7069 19.4234 26.5753 19.7413 26.3409 19.9758L25.2802 21.0364C24.8138 21.5029 24.2453 21.8546 23.6195 22.0633C23.1867 22.2075 22.7342 22.2788 22.2805 22.2794C22.28 22.733 22.2087 23.1855 22.0644 23.6183C21.8557 24.2441 21.504 24.8126 21.0376 25.2791L19.9769 26.3397C19.7425 26.5741 19.4246 26.7057 19.093 26.7057C18.7615 26.7057 18.4436 26.5741 18.2092 26.3397C17.9747 26.1053 17.8432 25.7874 17.8432 25.4558C17.8432 25.1243 17.9747 24.8064 18.2092 24.572L19.2698 23.5113L19.3858 23.3829C19.641 23.0714 19.7822 22.68 19.7822 22.2739C19.7822 21.8097 19.598 21.3646 19.2698 21.0364L16.9717 18.7383L16.2646 19.4454C16.0302 19.6799 15.7123 19.8114 15.3807 19.8114C15.0492 19.8114 14.7313 19.6799 14.4968 19.4454C14.2624 19.211 14.1309 18.8931 14.1309 18.5616C14.1309 18.23 14.2624 17.9121 14.4968 17.6777L15.204 16.9706L12.9059 14.6725C12.5777 14.3443 12.1326 14.1601 11.6684 14.1601C11.2043 14.1601 10.7592 14.3443 10.431 14.6725L9.37032 15.7331C9.1359 15.9675 8.81796 16.0991 8.48644 16.0991C8.15492 16.0991 7.83698 15.9675 7.60256 15.7331C7.36814 15.4987 7.23657 15.1808 7.23657 14.8492C7.23657 14.5177 7.36814 14.1998 7.60256 13.9654L8.66322 12.9047Z" stroke="white" strokeWidth="1.5"/>
          </svg>
        )}
        {mode === 'comment' && <CommentCursor />}
      </div>
    </div>
  );
});
